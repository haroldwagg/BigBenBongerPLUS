<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />

    <title>Big Ben Bonger PLUS</title>
</head>

<body>

  <div id="cvas" style="width: 310px; height: 321px; position: absolute; top: 0; left: 0;">
      <canvas id="myCanvas" width="310" height="321" style="border: none; position:absolute; left: 0; top: 0;">
      </canvas>
  </div>
                <div style="position: absolute; top: 0; right: 2px;"><img src="img/muter3.png" id="FPMuteButton" width="60" height="60" onClick="doFPMuteButton()" style="position: absolute; top: 6px; right: 2px; margin-top: 4px; visibility: hidden;" /></div>

                <div id="setupButtonDiv" style="position: absolute;  right: 2px; height: 70px;">

                <img src="img/options.png" height="55" width="55" id="setup_butt" onClick="doSetUp()" style="border: none; position: absolute; top: 0px; right: 2px; visibility: hidden;" />

<img src="img/bb_minute_hand.png" id="mh" style="display:none" />
<img src="img/bb_hour_hand.png" id="hh" style="display:none" />

                </div>
<!--
                <div id="tester" style:"background: red"><h2>TESTER</h2></div>  top: 180px;
-->

                <div id="panel1" style="background-color: rgba(230, 230, 255, 0.95);  margin-left: 8px; position:absolute; left: 10px; top: 0px;">
                  <table id="panel1Table" style="border: none; float: left; font-size: 12px; margin: 8px;">
                    <tr><td align="left" nowrap="nowrap">
                       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #0000aa; font-weight: bold">BONG:</span>&nbsp;&nbsp;<select name="clocker" id="clocker" onChange="changeClock()" style="font-size: 1.1em; margin-bottom: 5px;"></select>

                      <br />
                      <input checked type="checkbox" class="checkers" name="quart" id="Quarter"  onClick="do1545Option()"><div id="15_45_Label" style="margin: 0; padding: 0; display: inline-block"></div><br />
                      <input checked type="checkbox" class="checkers" name="half" id="Half"  onClick="doHalfHourOption()"><div id="Half_Label" style="margin: 0; padding: 0; display: inline-block"></div><br />
                      <input checked type="checkbox" class="checkers" name="hhourr" id="Hour-strikes" onClick="doHourStrikeOption()"><div id="Hour_Label" style="margin: 0; padding: 0; display: inline-block"></div>
                      <br /><br /><img  src="img/juk.png" id="spkr" style="margin: 0; padding: 0; height: 20px; width: 20px; margin-right: 0.8em; margin-top: 0px; margin-bottom: -3px;"  /><input type="button" value="  &mdash;  " style="font-size: 1em;  border: 1px solid black; margin: 0; padding: 0; margin-right: 8px; margin-top: 0px; padding-top: 4px; padding-bottom: 3px;" onClick="changeVolume('-')" /><progress id="prog" name="prog" value="0.4" max="1.0">
                      </progress><input type="button" value="   +   " style="font-size: 1em;  border: 1px solid black; margin: 0; padding: 0; margin-left: 0.8em; padding-top: 4px; margin-right: 1.5em; padding-bottom: 3px;" onClick="changeVolume('+')" />

                      <br /><span style="color: #0000bb"><hr /></span>

                      <div id="usePendulumLabel" style="margin: 0; padding: 0; display: inline-block; margin-bottom: 3px;"></div><input type="radio" name="whichbuttons" onClick="startPendulum()" id="pend_but_on" style="vertical-align: text-bottom">ON&nbsp;&nbsp;&nbsp;<input checked type="radio" name="whichbuttons" id="pend_but_off" onClick="stopPendulum()" style="vertical-align: text-bottom">OFF<br />
                      <img  src="img/pendIcon.png" id="pend" style="margin: 0; padding: 0; height: 25px; width: 25px; margin-right: 0.8em; margin-top: 5px; margin-bottom: -8px; margin-left: 35px;"  /><input type="button" value="  &mdash;  " style="background-color: #e5c799; font-size: 1em;  border: 1px solid black; margin: 0; padding: 0; margin-right: 8px; margin-top: 0px; margin-bottom: 9px; padding-top: 4px; padding-bottom: 3px;" onClick="changePendVolume('-')" /><progress id="pendVol" name="pendVol" value="0.4" max="1.0" style="color: white; height: 5px; width: 90px;">
                      </progress><input type="button" value="   +   " style="background-color: #e5c799; font-size: 1em;  border: 1px solid black; margin: 0; padding: 0; margin-left: 0.8em; margin-bottom: 5px; padding-top: 4px; margin-right: 1.5em; padding-bottom: 3px;" onClick="changePendVolume('+')" />
                     </td></tr>
                  </table>
                </div>

                <div id="panel2" style="background-color: rgba(230, 230, 255, 0.95);  margin-top:0; padding-top:0; margin-left: 8px; position:absolute; left: 10px; top: 246px;">
                  <table id="panel2Table" style="border: none; float: left; font-size: 12px; margin: 8px; margin-top: 0;">
                    <tr><td align="left" nowrap="nowrap">

                      <span style="color: #0000bb" id="t2id"><hr /></span>

                      <input type="checkbox" class="checkers" name="useQT" id="useQT" onClick="doQuietTimeOption()"><div id="useQTLabel" style="margin: 0; padding: 0; display: inline-block; margin-bottom: 3px;"></div><br />
                      <div id="startSelectDiv" style="width: 125px; display: inline"></div><div id="endSelectDiv" style="display: inline; width: 125px;"></div>
                      <br />
                      <div id="SstartLabel" style="color: black; margin-left: 41px; text-transform: none; width: 200px; display: inline;"></div><div id="EendLabel" style="color: black; margin-left: 63px; text-transform: none; display: inline"></div>



                      <span style="color: #0000bb"><hr /></span>
                      <input type="checkbox" class="checkers" name="no_phone_mute" id="no_phone_mute" onClick="doPhoneMute()"><div id="bongDuringCall" style="margin: 0; padding: 0; display: inline-block"></div>
                      <br />


                      <input type="checkbox" class="checkers" name="autostart" id="autostart" onClick="doAutoStart()">&nbsp;<div id="autoStartTextDiv" style="margin: 0; padding: 0; display: inline-block"></div>

                      <span style="color: #0000bb"><hr /></span>
                      <div id="themeLabel" style="margin: 0; padding: 0; display: inline-block; margin-bottom: 3px;"></div><br><input type="radio" name="themebuttons" onClick="doBigBenTheme()" id="big_ben_but" style="margin-left: 35px; vertical-align: text-bottom">BIG BEN&nbsp;&nbsp;&nbsp;<input type="radio" name="themebuttons" id="london_but" onClick="doLondonTheme()" style="vertical-align: text-bottom">LONDON<br />
                      <div style="height: 20px; width: 100%"><span style="float: right;"><a onClick="doSetUp()">
                        <svg version="1.1" id="Layer_1" height="20" width="20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                        	 viewBox="0 0 492 492" style="enable-background:new 0 0 492 492;" xml:space="preserve">
                        <g>
                        	<g>
                        		<path d="M464.344,207.418l0.768,0.168H135.888l103.496-103.724c5.068-5.064,7.848-11.924,7.848-19.124
                        			c0-7.2-2.78-14.012-7.848-19.088L223.28,49.538c-5.064-5.064-11.812-7.864-19.008-7.864c-7.2,0-13.952,2.78-19.016,7.844
                        			L7.844,226.914C2.76,231.998-0.02,238.77,0,245.974c-0.02,7.244,2.76,14.02,7.844,19.096l177.412,177.412
                        			c5.064,5.06,11.812,7.844,19.016,7.844c7.196,0,13.944-2.788,19.008-7.844l16.104-16.112c5.068-5.056,7.848-11.808,7.848-19.008
                        			c0-7.196-2.78-13.592-7.848-18.652L134.72,284.406h329.992c14.828,0,27.288-12.78,27.288-27.6v-22.788
                        			C492,219.198,479.172,207.418,464.344,207.418z"/>
                        	</g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        <g>
                        </g>
                        </svg>
                      </a>
                    </span></div>
                    </td></tr>
                  </table>
                </div>

                <div id="statusPanel" style="z-index: -20"></div>

                <div id="clock" style="color: '#999900';  position: absolute; display: none; z-index: -10"></div>

                <div id="bottomNavBar" style="background-color: black; margin: 0; padding: 0; height: 54px; position: fixed; bottom: 0%; width: 100%; overflow:visible;">

                  <img src="help.png" onClick="doHelp()" width="30" height="30" id="helpIcon" style="margin-left: 8px; margin-top: 5px;" />

                  <img id="ximage" name="ximage" src="x.png" width="45" height="45" style="float: right; border: none;  padding: 0; margin-top: 5px; margin-right: 8px;" onClick="confirmExit()" />
                  <img id="minimage" name="minimage" src="img/min.png" width="45" height="45" style="float: right; border: none; margin-top: 5px;" onClick="doGoToBG()" />
                  <div id="clearr" style=" clear: both;"></div>
                </div>


    <script type="text/javascript" src="cordova.js"></script>

    <script type="text/javascript" src="js/index.js"></script>


    <script type="text/javascript" src="js/pluginUtils.js"></script>
    <script type="text/javascript">

      var src;
      var MASTER_MUTE = false;
      var QUARTER_MUTE = false;
      var HALF_MUTE = false;
      var THREE_QUARTER_MUTE = false;
      var DO_STRIKES = true;
      var MASTER_VOLUME = 0.4;
      var CURRENT_VOLUME = 0.4;
      var loopDelay;
      var loopThread;
      var QUARTER_HOUR_SYNC = false;
      var lastVolumePush = "Neither";
      var my_media_TEST = "NOT_RUNNING";
      var my_media_WHICH = "NOT_RUNNING";
      var my_media2;
      var my_media;
      var media_PEND;
      var FRONT_PANEL_MUTE = false;
      var PEND_VOLUME = 0.4;
      var PEND_STATUS = "RUNNING";
      var pendulumID;
      var pendSoundFile = "";
      var pendulumRunning = false;
      var START_TIME = 0;
      var firstTimeInBG = true;

      var ORIENT;
      var SIZE;
      var DEVICE_TYPE;
      var D_MyCanvas, D_FPMuteButton, D_setupButtonDiv, D_helpIcon, D_minimage, D_ximage, D_clock;

      var QUARTER_DING       = "bb_quarter.mp3";
      var HALF_DING          = "bb_half.mp3";
      var THREE_QUARTER_DING = "bb_three-quarter.mp3";
      var HOUR_DING          = "bb_hour.mp3";
      var DING_SELECTION;
      var do24Hr = false;
      var myLang;

      var Timeouter;
      var delayRelease;

      var DUP_EXIT = false;

      var dingThread;
      var ctx;
      var lang;
      var XStr;
      var setupIsDisplayed = false;
      var helpText, helpTextTitle, mantleClockText, grandfatherClockText, helpDismissText, quitConfirmText, backgroundNotificationText, optionsInText, optionsOutText;
      var quietTimeText1, quietTimeText2, muteText1, muteText2, noPendulumAdjustText, quietTimeTextNotification, muteTextNotification;
      var notificationPrefixText = "";
      var mySavedStates = false;

      var p = window.location.pathname;
      this.root = p.substring(0, p.lastIndexOf('/')) + "/";

      var body = document.getElementsByTagName('body')[0];

      var canvas;
      var ctx;
      var minuteHand;
      var hourHand;
      var xcounter = 0;

      var HOUR_HAND_CORRECTION_FACTOR = 0;

      function init()   {
        var d = new Date();
        var mins = d.getMinutes();
        D_clock.innerHTML = "&nbsp;" + makeTimeString() + "&nbsp;";

        var secs = d.getSeconds();
        loopDelay = (60 - secs) * 1000;

// Fix loop creep (I hope)
        loopDelay += 1000;

        doTimeDisplay(d.getHours(), mins);

        cordova.plugins.backgroundMode.configure({ text: notificationPrefixText + backgroundNotificationText, resume: true  });

        if (! cordova.plugins.backgroundMode.isActive())   {
          window.plugins.insomnia.keepAwake();
        }

        doQuietTimeOption();

        clearTimeout(loopThread);
        loopThread = setTimeout(doMainLoop, loopDelay);
// alert("End init()");
      }

      function makeTimeString()   {
        var d = new Date();
        var mins = d.getMinutes();
        var n = d.getHours();
        var delimiter = ":";

        if (do24Hr)   {
          if (localStorage["language"] == "de")   {
            delimiter = ".";
            if (n < 10)   {
              n = "&nbsp;&nbsp;" + n;
            }
          }
          else   {
            if (n < 10)   {
              n = "0" + n;
            }
          }
        }
        else   {
          if (n == 0)   {
            n = 12;
          }
          if (n > 12)   {
            n -= 12;
          }

          if (n < 10)   {
            n = "&nbsp;&nbsp;" + n;
          }
        }

        if (mins < 10)   {
          mins = "0" + mins;
        }

        return ("" + n + delimiter + mins);

      }

      function makeTimeSelect(name, stylestr, preselect)   {
        var outStr = "";
        var tmp = "";
        var displayMin = "";
        var displayHr = "";

        preselect = parseInt(preselect);

        outStr += '<select name="' + name + '" id="' + name + '"';

        if (stylestr == "" || stylestr == null || stylestr == "undefined")   {
          outStr += ' onChange="document.getElementById(\'useQT\').checked=true; doQuietTimeOption();">\n';
//          outStr += ' onChange="doQuietTimeOption();">\n';
        }
        else   {
          outStr += ' style="' + stylestr + '" onChange="document.getElementById(\'useQT\').checked=true; doQuietTimeOption();">\n';
//          outStr += ' style="' + stylestr + '" onChange="doQuietTimeOption();">\n';
        }

        for (var hr = 0; hr < 24; ++hr)   {
          for (var min = 0; min < 60; min += 15)   {
            tmp = (parseInt(hr) * 100) + parseInt(min);

            if (min < 10)   {
              displayMin = "0" + min;
            }
            else   {
              displayMin = min;
            }

            if (do24Hr)   {
              if (hr < 10)   {
                displayHr = "0" + hr;
              }
              else   {
                displayHr = hr;
              }

              if (name == "eend")   {
                var xhr = parseInt(hr);
                if (min == 0)   {
                  if (xhr == 0)   {
                    xhr = 24;
                  }

                  --xhr;
                  tmp = (parseInt(xhr) * 100) + 59;
                }
                else   {
                  var xmins = parseInt(min);
                  --xmins;
                  tmp = (parseInt(xhr) * 100) + xmins;
                }
              }

              outStr += '<option value="' + tmp + '"';

              if (preselect == tmp)   {
                outStr += " selected";
              }

              outStr += ">&nbsp;" + displayHr + ":" + displayMin + "&nbsp;</option>\n";
            }
            else   {
              var ampm = "AM";

              if (hr == 0)   {
                displayHr = "12";
              }
              else if (hr < 12)   {
                displayHr = hr;
              }
              else if (hr == 12)   {
                displayHr = hr;
                ampm = "PM";
              }
              else   {
                displayHr = hr - 12;
                ampm = "PM";
              }

              if (name == "eend")   {
                var xhr = hr;

                if (min == 0)   {
                  if (xhr == 0)   {
                    xhr = 24;
                  }

                  --xhr;
                  tmp = (parseInt(xhr) * 100) + 59;
                }
                else   {
                  var xmins = parseInt(min);
                  --xmins;
                  tmp = (parseInt(xhr) * 100) + xmins;
                }
              }

              outStr += '<option value="' + tmp + '"';

              if (preselect == tmp)   {
                outStr += " selected";
              }

              outStr += ">" + displayHr + ":" + displayMin + ampm + "</option>\n";
            }
          }
        }
        outStr += "</select>\n";
//        alert(outStr);
        return outStr;
      }

      function doMainLoop()   {
        var d = new Date();
        var mins = d.getMinutes();

        if (firstTimeInBG)   {
          firstTimeInBG = false;
          cordova.plugins.backgroundMode.configure({ text: notificationPrefixText + backgroundNotificationText, resume: true  });
        }

        D_clock.innerHTML = "&nbsp;" + makeTimeString() + "&nbsp;";

        doQuietTimeOption();

        if ((mins == 15) || (mins == 30) || (mins == 45))   {
          playBen(mins);
          init();
        }
        else if (mins == 59)   {
          if (localStorage["ding_selection"] == "bb")   {
            dingThread = setTimeout(function() {
              playBen(0);
              init();
            }, 43000);
          }
          else   {
            dingThread = setTimeout(function() {
              playBen(0);
              init();
            }, 60000);
          }

          doTimeDisplay(d.getHours(), mins);
          loopDelay = 60000;
          clearTimeout(loopThread);
          loopThread = setTimeout(doMainLoop, loopDelay);
        }
        else   {
          doTimeDisplay(d.getHours(), mins);
          loopDelay = 60000;
          clearTimeout(loopThread);
          loopThread = setTimeout(doMainLoop, loopDelay);
        }
      }

      function playBen(x)   {
        var phoneAdjustmentsHaveBeenMade = false;

        if (isQuietTime())   {
          return;
        }

        if (FRONT_PANEL_MUTE)   {
          return;
        }

        if (typeof(my_media) == "object")   {
          my_media.stop();
          my_media.release();
        }


//        if (pendulumRunning)   {
//          pendulumRunning = false;
//
//          clearTimeout(pendulumID);
//
//          if (typeof(media_PEND) == "object")   {
//            media_PEND.stop();
//            media_PEND.release();
//          }
//
//          media_PEND = null;
//        }

        if (MASTER_MUTE)   {
          if (document.getElementById("no_phone_mute").checked == true)   {
            MASTER_MUTE = false;
            CURRENT_VOLUME = 0.1;
            phoneAdjustmentsHaveBeenMade = true;
          }
        }

        src = "";

        if ((x == "15") && (! QUARTER_MUTE) && (! MASTER_MUTE))   {
          src = this.root + "audio/" + QUARTER_DING;
        }
        else if ((x == "30") && (! HALF_MUTE) && (! MASTER_MUTE))   {
          src = this.root + "audio/" + HALF_DING;
        }
        else if ((x == "45") && (! THREE_QUARTER_MUTE) && (! MASTER_MUTE))   {
          src = this.root + "audio/" + THREE_QUARTER_DING;
        }
        else if ((x == "00") && (! MASTER_MUTE))   {
          src = this.root + "audio/" + HOUR_DING;

          if (DO_STRIKES)   {
            if (typeof(my_media2) == "object")   {
              my_media2.stop();
              my_media2.release();
            }

            var deela;
            if (DING_SELECTION == "bb")   {
              deela = 15800;
            }
            else if (DING_SELECTION == "gf")   {
              deela = 16000;
            }
            else if (DING_SELECTION == "cc")   {
              deela = 800;
            }
            else if (DING_SELECTION == "tr")   {
              deela = 14600;
            }
            else if (DING_SELECTION == "ec")   {
              deela = 18200;
            }            else   {
              deela = 13000;
            }

            setTimeout(function()   {
              var d = new Date();
              var n = d.getHours();
              var mins = d.getMinutes();

//  Big Ben starts at XX:59:44.  It is  not impossible that we get here just before the hour change (e.g., XX:59:59.88)
//  This is just a double check that the time has rolled over to the new hour.
//  If not rolled over yet, increment the hour.

              if (mins == 59)   {
                n++;
                if (n == 24)   {
                  n = 0;
                }
              }

              if (n == 0)   {
                n = 12;
              }
              if (n > 12)   {
                n -= 12;
              }

              if (FRONT_PANEL_MUTE)   {
                return;
              }

              var inserter;

              inserter = localStorage["ding_selection"] + "_";

              var dingerFile = this.root + "audio/" + inserter + n + ".mp3";
              my_media2 = new Media(dingerFile,
                function () { console.log("playAudio():Audio Success"); },
                ignoreError()
              );

              my_media2.play({ playAudioWhenScreenIsLocked : true });
              my_media2.setVolume(CURRENT_VOLUME);

              if (phoneAdjustmentsHaveBeenMade)   {
                phoneAdjustmentsHaveBeenMade = false;
                CURRENT_VOLUME = MASTER_VOLUME;
                MASTER_MUTE = true;
              }
            }, deela);
          }
        }

        if (src != "")   {
          my_media = new Media(src,
            function () { console.log("playAudio():Audio Success"); },
            ignoreError()
          );

          my_media.play({ playAudioWhenScreenIsLocked : true });
          my_media.setVolume(CURRENT_VOLUME);
        }

        if ((phoneAdjustmentsHaveBeenMade && x != "00") || (phoneAdjustmentsHaveBeenMade && ! DO_STRIKES && x == "00"))   {
          phoneAdjustmentsHaveBeenMade = false;
          CURRENT_VOLUME = MASTER_VOLUME;
          MASTER_MUTE = true;
        }

//        if (pendulumRunning)   {
//          unmutePendulum();
//        }

      }

      function initializeCanvas()   {
        canvas = document.getElementById("myCanvas");
        ctx = canvas.getContext('2d');

        if (SIZE == "small")   {
          ctx.translate(116, 127);
          minuteHand = document.getElementById("mh");
          hourHand = document.getElementById("hh");
        }
        else   {
          var d2 = new Date();
          var min2 = d2.getMinutes();
          var hr2 = d2.getHours();

          ctx.translate(116, 127);
          minuteHand = new Image();
          minuteHand.onload = function() {
            doTimeDisplay(hr2, min2);
          };
          minuteHand.src = 'img/bigMinuteHand.png';

          hourHand = new Image();
          hourHand.onload = function() {
            doTimeDisplay(hr2, min2);
          };
          hourHand.src = 'img/bigHourHand.png';
        }
      }

      function doTimeDisplay(hrs, minte)   {
        var handPosition;
        var m = parseInt(minte);
        var hourHandPosition;

        if (SIZE == "small")   {
          ctx.clearRect(-116, -127, canvas.width, canvas.height);
        }
        else   {
          ctx.clearRect(-116, -127, canvas.width, canvas.height);
        }

        handPosition = m * 6 * Math.PI / 180;

        ctx.rotate(handPosition);

        if (SIZE == "small")   {
          ctx.drawImage(minuteHand, -13,  -182);
        }
        else   {
          ctx.drawImage(minuteHand, -14,  -177);
        }

        ctx.rotate(handPosition * -1);

        hrs %= 12;

        hourHandPosition = ((hrs * 6 * 5) * Math.PI / 180) + (((m + HOUR_HAND_CORRECTION_FACTOR) * 6 * Math.PI / 180) / 12);
        ctx.rotate(hourHandPosition);

        if (SIZE == "small")   {
          ctx.drawImage(hourHand, -16, -100);
        }
        else   {
          ctx.drawImage(hourHand, -17, -94);
        }

        ctx.rotate(hourHandPosition * -1);



//        ctx.drawImage(minuteHand, -9, -150, 21, 188);

//        handPosition = 5 * 6 * Math.PI / 180;
//        ctx.rotate(handPosition);
//        ctx.drawImage(minuteHand, 67, -70);

      }

      function doSetUp()   {
        var panelStyle = document.getElementById("panel1").style;
        var panel2Style = document.getElementById("panel2").style;

        var theCheckboxes = document.getElementsByClassName("checkers");

        if (SIZE == "big")   {
          document.getElementById("sstart").style.fontSize = "22px";
          document.getElementById("eend").style.fontSize = "22px";
//          panelStyle.position = "relative";
//          panelStyle.left = "5px";
//          panelStyle.top = "0px";
//          panelStyle.top = "200px";
        }

        if (! setupIsDisplayed)   {
          setupIsDisplayed = true;
          var ratio = window.devicePixelRatio || 1;
          var h = screen.height;

          if (SIZE == "big")   {
            panelStyle.height = '375px';
            panel2Style.height = '375px';

            if (localStorage["language"] == "fr")   {
              panelStyle.width = '420px';
              panel2Style.width = '420px';
            }
            else if (localStorage["language"] == "pt")   {
              panelStyle.width = '505px';
              panel2Style.width = '405px';
            }
            else if (localStorage["language"] == "de")   {
              panelStyle.width = '485px';
              panel2Style.width = '485px';
            }
            else if (localStorage["language"] == "it")   {
              panelStyle.width = '485px';
              panel2Style.width = '485px';
            }
            else   {
              panelStyle.width = '425px';
              panel2Style.width = '425px';
            }

            document.getElementById("Quarter").style.marginTop = "10px";
            document.getElementById("Half").style.marginTop = "8px";
            document.getElementById("Hour-strikes").style.marginTop = "8px";
            document.getElementById("spkr").style.width = "40px";
            document.getElementById("spkr").style.height = "40px";
            document.getElementById("sprk").style.marginBottom = "-8px";
          }
          else   {
            panelStyle.height = '230px';
            panel2Style.height = '230px';

            if (localStorage["language"] == "fr")   {
              panelStyle.width = '275px';
              panel2Style.width = '275px';
            }
            else if (localStorage["language"] == "pt")   {
              panelStyle.width = '315px';
              panel2Style.width = '315px';
            }
            else if (localStorage["language"] == "de")   {
              panelStyle.width = '282px';
              panel2Style.width = '282px';
            }
            else if (localStorage["language"] == "it")   {
              panelStyle.width = '315px';
              panel2Style.width = '315px';
            }
            else   {
              panelStyle.width = '280px';
              panel2Style.width = '280px';
            }

            document.getElementById("spkr").style.width = "22px";
            document.getElementById("spkr").style.height = "22px";
          }
        }
        else   {
          setupIsDisplayed = false;
          panelStyle.width = '0px';
          panel2Style.width = '0px';
        }

        clearTimeout(loopThread);
        init();
      }

      function isQuietTime()   {
        if (document.getElementById("useQT").checked == false)   {
          return false;
        }

        var start_int = parseInt(document.getElementById("sstart").value);
        var end_int = parseInt(document.getElementById("eend").value);

        localStorage["sstart"] = start_int;
        localStorage["eend"] = end_int;

  //        alert ("Start Time: " + start_int + "\nEnd Time: " + end_int + "\n");

        var today = new Date();
        var h = today.getHours();
        var m = today.getMinutes();
        var current_int = (h * 100) + m;

        if (start_int < end_int)   {
          if ((current_int > start_int) && (current_int < end_int))   {
alert("isQuietTime returns true");
            return true;
          }
        }
        else   {
          if ((current_int > start_int) || (current_int < end_int))   {
alert("isQuietTime returns true");
            return true;
          }
        }
alert("isQuietTime returns false");
        return false;
      }

      function startPendulum()   {

        clearTimeout(pendulumID);

        PEND_STATUS = "RUNNING";
        localStorage["pend_status"] = "checked";
        pendulumRunning = true;

        pendulumLooper();
      }

      function pendulumLooper()   {
        if (FRONT_PANEL_MUTE || isQuietTime())   {
          stopPendulum();
          return;
        }

        if (pendSoundFile == "")   {
          pendSoundFile = this.root + "audio/" + "ticker.mp3";
          media_PEND = new Media(pendSoundFile,
              function () { console.log("playAudio():Audio Success"); },
              ignoreError()
            );
        }
        else   {
          media_PEND.seekTo(0);
        }

        media_PEND.play();
        media_PEND.setVolume(PEND_VOLUME);

        pendulumID = setTimeout(pendulumLooper, 3600000);
      }

      function stopPendulum()   {
        PEND_STATUS = "STOPPED";
        localStorage["pend_status"] = "no";
        pendulumRunning = false;
        pendSoundFile = "";

        clearTimeout(pendulumID);

        if (typeof(media_PEND) == "object")   {
          media_PEND.stop();
          media_PEND.release();
        }

        media_PEND = null;
      }

      function mutePendulum()   {
        if (typeof(media_PEND) == "object")   {
          media_PEND.setVolume(0.0);
        }
      }

      function unmutePendulum()   {
        if (typeof(media_PEND) == "object")   {
          media_PEND.setVolume(PEND_VOLUME);
        }
      }

      function changePendVolume(dir)   {
        unmutePendulum();

        if (dir == "+")   {
          if (PEND_VOLUME < 1.0)   {
            PEND_VOLUME += 0.1;
          }
        }
        else   {
          if (PEND_VOLUME > 0.0)   {
            PEND_VOLUME -= 0.1;
          }
        }

        document.getElementById("pendVol").value = PEND_VOLUME;
        media_PEND.setVolume(PEND_VOLUME);

        localStorage["pend_vol"] = PEND_VOLUME.toString();
      }


      function doFPMuteButton()   {
//        alert ("Value is " + FRONT_PANEL_MUTE);

        if (FRONT_PANEL_MUTE)   {

          FRONT_PANEL_MUTE = false;

          changeNotification("Off");

// alert("localStorage[pend_status] = " + localStorage["pend_status"] + " and isQuietTime is " + isQuietTime());

          unmutePendulum()
        }
        else   {
          FRONT_PANEL_MUTE = true;

          changeNotification("Mute On");
          mutePendulum();

          if (typeof(my_media2) == "object")   {
            my_media2.stop();
            my_media2.release();
          }

          if (typeof(my_media) == "object")   {
            my_media.stop();
            my_media.release();
          }

          if (my_media_TEST != "NOT_RUNNING")   {
            my_media_TEST.stop();
            my_media_TEST.release();
          }

          if (my_media_WHICH != "NOT_RUNNING")   {
            my_media_WHICH.stop();
            my_media_WHICH.release();
          }
        }

        displayStatusPanel();
      }


      function doHourStrikeOption()   {
        if (DO_STRIKES)   {
          DO_STRIKES = false;
          document.getElementById("Hour-strikes").checked = false;
          localStorage["hour-strikes"] = "no";
        }
        else   {
          DO_STRIKES = true;
          document.getElementById("Hour-strikes").checked = true;
          localStorage["hour-strikes"] = "checked";
        }
      }

      function do1545Option()   {
        if (QUARTER_MUTE)   {
          QUARTER_MUTE = false;
          THREE_QUARTER_MUTE = false;
          document.getElementById("Quarter").checked = true;
          localStorage["quarter"] = "checked";
        }
        else   {
          QUARTER_MUTE = true;
          THREE_QUARTER_MUTE = true;
          document.getElementById("Quarter").checked = false;
          localStorage["quarter"] = "no";
        }
      }

      function doHalfHourOption()   {
        if (HALF_MUTE)   {
          HALF_MUTE = false;
          document.getElementById("Half").checked = true;
          localStorage["half"] = "checked";
        }
        else   {
          HALF_MUTE = true;
          document.getElementById("Half").checked = false;
          localStorage["half"] = "no";
        }
      }


    function doOnOrientationChange()   {
      loadGlobals();

      if (localStorage["theme"] == "BigBen")   {
        doBigBenTheme();
      }
      else   {
        doLondonTheme();
      }

      displayStatusPanel();
    }


      window.addEventListener('orientationchange', doOnOrientationChange);

      document.addEventListener("deviceready", starter, false);

//     window.onload = setTimeout(function() {starter();}, 2000);



//////////////////////////////////////////////////////
///  STARTER  ////////////////////////////////////////
//////////////////////////////////////////////////////

      function starter()   {

          cordova.plugins.backgroundMode.setDefaults({
          title: "Big Ben Bonger Background",
          text: "[Tap HERE to Restore]",
          resume: true,
          hidden: false
        });

        getScreenSize();

        setLanguage();

        cordova.plugins.backgroundMode.configure({ text: "[Tap HERE to Restore]", resume: true  });

        cordova.plugins.backgroundMode.setEnabled(true);

        D_MyCanvas = document.getElementById("myCanvas");
        D_FPMuteButton = document.getElementById("FPMuteButton");
        D_setupButtonDiv = document.getElementById("setupButtonDiv");
        D_helpIcon = document.getElementById("helpIcon");
        D_minimage = document.getElementById("minimage");
        D_ximage = document.getElementById("ximage");
        D_clock = document.getElementById("clock");


        loadGlobals();

        if (localStorage["theme"] == "BigBen")   {
          document.getElementById("big_ben_but").checked = true;
          doBigBenTheme();
        }
        else if (localStorage["theme"] == "London")   {
          document.getElementById("london_but").checked = true;
          doLondonTheme();
        }
        else   {
          localStorage["theme"] = "BigBen";
          document.getElementById("big_ben_but").checked = true;
          doBigBenTheme();
        }

        cordova.plugins.backgroundMode.configure({ text: notificationPrefixText + backgroundNotificationText, resume: true  });

        var body = document.getElementsByTagName('body')[0];
        var ratio = window.devicePixelRatio || 1;
        var h = screen.height;

        if (SIZE == "big")   {
          body.style.fontSize = "22px";
          D_MyCanvas.style.width = "620px";
          D_MyCanvas.style.height = "642px";
        }
        else   {
          body.style.fontSize = "12px";
        }


        if (SIZE == "big")   {
          D_ximage.style.width = "70px";
          D_ximage.style.height = "70px";
          D_minimage.style.width = "70px";
          D_minimage.style.height = "70px";
          D_helpIcon.style.width = "70px";
          D_helpIcon.style.height = "70px";
          document.getElementById("no_phone_mute").style.width = "35px";
          document.getElementById("no_phone_mute").style.height = "35px";
          document.getElementById("Quarter").style.width = "35px";
          document.getElementById("Quarter").style.height = "35px";
          document.getElementById("Half").style.width = "35px";
          document.getElementById("Half").style.height = "35px";
          document.getElementById("Hour-strikes").style.width = "35px";
          document.getElementById("Hour-strikes").style.height = "35px";
          document.getElementById("autostart").style.width = "35px";
          document.getElementById("autostart").style.height = "35px";
          document.getElementById("useQT").style.width = "35px";
          document.getElementById("useQT").style.height = "35px";
          document.getElementById("pend_but_on").style.width = "35px";
          document.getElementById("pend_but_on").style.height = "35px";
          document.getElementById("pend_but_off").style.width = "35px";
          document.getElementById("pend_but_off").style.height = "35px";
          document.getElementById("pend_but_off").style.marginBottom = "10px";
          document.getElementById("pend_but_on").style.marginBottom = "10px";
          document.getElementById("big_ben_but").style.width = "35px";
          document.getElementById("big_ben_but").style.height = "35px";
          document.getElementById("london_but").style.width = "35px";
          document.getElementById("london_but").style.height = "35px";
          document.getElementById("setup_butt").style.width = "95px";
          document.getElementById("setup_butt").style.height = "95px";

          document.getElementById("setup_butt").style.marginTop = "425px";
          document.getElementById("setup_butt").style.visibility = "visible";
          document.getElementById("FPMuteButton").style.visibility = "visible";
          document.getElementById("bottomNavBar").style.height = "75px";
          D_minimage.style.marginRight = "120px";
          document.getElementById("panel1Table").style.fontSize = "20px";
          document.getElementById("panel2Table").style.fontSize = "20px";

          document.getElementById("SstartLabel").style.marginLeft = "70px";
          D_FPMuteButton.style.width = "100px";
          D_FPMuteButton.style.height = "100px";
          D_FPMuteButton.style.marginLeft = "50px";

          if (ORIENT == 'landscape')   {
            D_setupButtonDiv.style.position = "relative";
            D_setupButtonDiv.style.marginTop = "0px";
            D_setupButtonDiv.style.marginRight = "10px";

          }
          else   {
            D_setupButtonDiv.style.position = "relative";
            D_setupButtonDiv.style.marginTop = "0px";
            D_setupButtonDiv.style.marginRight = "10px";
          }
        }
        else   {
          D_ximage.style.width = "45px";
          D_ximage.style.height = "45px";
          D_minimage.style.width = "42px";
          D_minimage.style.height = "42px";
          D_minimage.style.marginTop = "5px";
          D_minimage.style.marginRight = "100px";
          D_helpIcon.style.width = "45px";
          D_helpIcon.style.height = "45px";

          D_FPMuteButton.style.right = "2px";
          D_FPMuteButton.style.top = "0";

          if (ORIENT == "landscape") {
            D_setupButtonDiv.style.position = "fixed";
            D_setupButtonDiv.style.top = "210px";
            D_setupButtonDiv.style.right = "0px";
          }
          else   {
            D_setupButtonDiv.style.position = "fixed";
            D_setupButtonDiv.style.top = "216px";
            D_setupButtonDiv.style.right = "0px";
          }

          document.getElementById("setup_butt").style.visibility = "visible";
          document.getElementById("FPMuteButton").style.visibility = "visible";
        }



        processSavedSettings();

        window.plugins.insomnia.keepAwake();

        cordova.plugins.backgroundMode.on('activate', function() {
          cordova.plugins.backgroundMode.disableWebViewOptimizations();
        });

        PhoneCallTrap.onCall(function(state) {
          switch (state) {
            case "RINGING":
                MASTER_MUTE = true;
                break;
            case "OFFHOOK":
                MASTER_MUTE = true;
                break;
            case "IDLE":
                MASTER_MUTE = false;
                break;
          }
        });

        document.addEventListener("backbutton", function (e) {               // Disable Back Button
            e.preventDefault();
            var q = confirm(quitConfirmText);
            if (q == true)   {
              doExit();
            }
            else   {
              ;
            }
          },
        false );
      }

      function confirmExit()   {
        var q = confirm(quitConfirmText);
        if (q == true)   {
          doExit();
        }
        else   {
          return;
        }
      }

      document.addEventListener("resume", onResume, false);

      function onResume()   {

        window.plugins.insomnia.keepAwake();
        clearTimeout(loopThread);
        init();
      }

      document.addEventListener("pause", onPause, false);

      function onPause()   {

      }

      function doExit()   {
        clearTimeout(loopThread);
        window.plugins.insomnia.allowSleepAgain();
        navigator.app.exitApp();
      }

      function changeVolume(dir)   {
        if(my_media_WHICH != "NOT_RUNNING")   {
          clearTimeout(Timeouter);
          my_media_WHICH.stop();
          my_media_WHICH.release();
          my_media_WHICH = "NOT_RUNNING";
        }

        var pBar = document.getElementById("prog");

        if(my_media_TEST == "NOT_RUNNING")   {
          var dingerFile = this.root + "audio/" + THREE_QUARTER_DING;
          my_media_TEST = new Media(dingerFile,
                function () { console.log("playAudio():Audio Success"); },
                ignoreError()
          );

          my_media_TEST.play();

          var delay;
          if (DING_SELECTION == "bb")   {
            delay = 20000;
          }
          else   {
            delay = 20000;
          }

          delayRelease = setTimeout(function()   {
            my_media_TEST.stop();
            my_media_TEST.release();
            my_media_TEST = "NOT_RUNNING";
          }, delay);
        }

        if (dir == "+")   {
          if (MASTER_VOLUME < 1.0)   {
            MASTER_VOLUME =  MASTER_VOLUME + 0.1;
          }
        }
        else   {
          if (MASTER_VOLUME > 0.0)   {
            MASTER_VOLUME = MASTER_VOLUME - 0.1;
          }
        }

        pBar.value = MASTER_VOLUME;
        my_media_TEST.setVolume(MASTER_VOLUME);

        localStorage["volume"] = MASTER_VOLUME.toString();
//        alert (MASTER_VOLUME);
        CURRENT_VOLUME = MASTER_VOLUME;
      }

      function doGoToBG()   {
        window.plugins.insomnia.allowSleepAgain();

//        cordova.plugins.backgroundMode.setDefaults({
//          title: "Big Ben Bonger Background",
//          text: backgroundNotificationText,
//          resume: true,
//          hidden: false
//        });
//
//        cordova.plugins.backgroundMode.disableWebViewOptimizations();
//
        firstTimeInBG = true;
//        cordova.plugins.backgroundMode.configure({ text: notificationPrefixText + backgroundNotificationText, resume: true  });
        cordova.plugins.backgroundMode.moveToBackground();
      }

      function doHelp()   {
        navigator.notification.alert(
          helpText,
          "",
          helpTextTitle,
          helpDismissText
        );
      }

      function showScreenSize()   {
        var ratio = window.devicePixelRatio || 1;
        var h = screen.height;
        var w = screen.width;
      }

      function processSavedSettings()   {
//
//  Clock Selection
//
        if ((localStorage["ding_selection"] == "") || (localStorage["ding_selection"] == null) || (localStorage["ding_selection"] == "undefined"))   {
          localStorage["ding_selection"] = "bb";
        }

        if ((localStorage["ding_selection"] != "bb") && (localStorage["ding_selection"] != "bg") && (localStorage["ding_selection"] != "tr") && (localStorage["ding_selection"] != "cc") && (localStorage["ding_selection"] != "gf") && (localStorage["ding_selection"] != "ec"))   {
          localStorage["ding_selection"] = "bb";
        }

        QUARTER_DING = localStorage["ding_selection"] + "_quarter.mp3";
        HALF_DING  = localStorage["ding_selection"] + "_half.mp3";
        THREE_QUARTER_DING = localStorage["ding_selection"] + "_three-quarter.mp3";
        HOUR_DING = localStorage["ding_selection"] + "_hour.mp3";
        DING_SELECTION = localStorage["ding_selection"];

//
//  Mute during Phonecalls
//
        if ((localStorage["no_phone_mute"] != "checked") && (localStorage["no_phone_mute"] != "no"))   {
          localStorage["no_phone_mute"] = "no";
        }

        if (localStorage["no_phone_mute"] == "checked")   {
          document.getElementById("no_phone_mute").checked = true;
        }
        else   {
          document.getElementById("no_phone_mute").checked = false;
        }

//        alert ("DING: " + localStorage["ding_selection"] + "\n\nMUTE: " + localStorage["no_phone_mute"]);

//
//  15 & 45 Chimes
//
        if ((localStorage["quarter"] != "checked") && (localStorage["quarter"] != "no"))   {
          localStorage["quarter"] = "checked";
        }

        if (localStorage["quarter"] == "checked")   {
          QUARTER_MUTE = false;
          THREE_QUARTER_MUTE = false;
          document.getElementById("Quarter").checked = true;
        }
        else   {
          QUARTER_MUTE = true;
          THREE_QUARTER_MUTE = true;
          document.getElementById("Quarter").checked = false;
        }

//
//  Half-hour Chimes
//
        if ((localStorage["half"] != "checked") && (localStorage["half"] != "no"))   {
          localStorage["half"] = "checked";
        }

        if (localStorage["half"] == "checked")   {
          HALF_MUTE = false;
          document.getElementById("Half").checked = true;
       }
        else   {
          HALF_MUTE = true;
          document.getElementById("Half").checked = false;
        }

//
//  On-the-hour Strikes
//
        if ((localStorage["hour-strikes"] != "checked") && (localStorage["hour-strikes"] != "no"))   {
          localStorage["hour-strikes"] = "checked";
        }

        if (localStorage["hour-strikes"] == "checked")   {
          DO_STRIKES = true;
          document.getElementById("Hour-strikes").checked = true;
       }
        else   {
          DO_STRIKES = false;
          document.getElementById("Hour-strikes").checked = false;
        }

//
//  Volume
//
        if ((localStorage["volume"] == "undefined") || (localStorage["volume"] == "") || (localStorage["volume"] == null))   {
          localStorage["volume"] = "0.4";
        }

        if (parseFloat(localStorage["volume"]) < 0.1)   {
          localStorage["volume"] = "0.1";
        }
        else if (parseFloat(localStorage["volume"]) > 1.0)   {
          localStorage["volume"] = "1.0";
        }

        MASTER_VOLUME = parseFloat(localStorage["volume"]);
        CURRENT_VOLUME = MASTER_VOLUME;
        document.getElementById("prog").value = CURRENT_VOLUME;

//
//  Quiet Time
//
        if ((localStorage["useqt"] != "checked") && (localStorage["useqt"] != "no"))   {
          localStorage["useqt"] = "no";
        }

        if (localStorage["useqt"] == "checked")   {
          document.getElementById("useQT").checked = true;
        }
        else   {
          document.getElementById("useQT").checked = false;
        }

//
//  Pendulum Volume
//
        if ((localStorage["pend_status"] != "checked") && (localStorage["pend_status"] != "no"))   {
          localStorage["pend_status"] = "no";
        }

        if (localStorage["pend_status"] == "checked")   {
          document.getElementById("pend_but_on").checked = true;
          document.getElementById("pend_but_off").checked = false;
          PEND_STATUS = "RUNNING";
          pendulumRunning = true;
        }
        else   {
          document.getElementById("pend_but_off").checked = true;
          document.getElementById("pend_but_on").checked = false;
          PEND_STATUS = "STOPPED";
          pendulumRunning = false;
        }

        if ((localStorage["pend_vol"] == "undefined") || (localStorage["pend_vol"] == "") || (localStorage["pend_vol"] == null))   {
          localStorage["pend_vol"] = "0.4";
        }

        if (parseFloat(localStorage["pend_vol"]) < 0.1)   {
          localStorage["pend_vol"] = "0.1";
        }
        else if (parseFloat(localStorage["pend_vol"]) > 1.0)   {
          localStorage["pend_vol"] = "1.0";
        }

        PEND_VOLUME = parseFloat(localStorage["pend_vol"]);
        document.getElementById("pendVol").value = PEND_VOLUME;

        if ((PEND_STATUS == "RUNNING") && (! isQuietTime()))   {
          startPendulum();
        }

//
//  AutoStart
//
        if ((localStorage["autostart"] != "checked") && (localStorage["autostart"] != "no"))   {
          localStorage["autostart"] = "no";
        }

        if (localStorage["autostart"] == "checked")   {
          document.getElementById("autostart").checked = true;
          cordova.plugins.autoStart.enable();
        }
        else   {
          document.getElementById("autostart").checked = false;
          cordova.plugins.autoStart.disable();
        }
      }


      function doQuietTimeOption()   {
        if (document.getElementById("useQT").checked == true)   {
          localStorage["useqt"] = "checked";

          if (isQuietTime())   {
            changeNotification("Quiet Time");

            document.getElementById("pend_but_on").disabled = true;
            document.getElementById("pend_but_off").disabled = true;

            if (localStorage["pend_status"] == "checked")   {
              pendulumRunning = false;

              clearTimeout(pendulumID);

              if (typeof(media_PEND) == "object")   {
                media_PEND.stop();
                media_PEND.release();
              }

              media_PEND = null;
            }
          }
          else   {
            if (notificationPrefixText == quietTimeTextNotification)   {
              changeNotification("Off");
            }

            document.getElementById("pend_but_on").disabled = false;
            document.getElementById("pend_but_off").disabled = false;

            if (localStorage["pend_status"] == "checked")   {
              startPendulum();
              pendulumRunning = true;
            }
          }
        }
        else   {
          if (notificationPrefixText == quietTimeTextNotification)   {
            changeNotification("Off");
          }

          document.getElementById("pend_but_on").disabled = false;
          document.getElementById("pend_but_off").disabled = false;

          localStorage["useqt"] = "no";

          if (localStorage["pend_status"] == "checked")    {
            startPendulum();
            pendulumRunning = true;
          }
        }

        displayStatusPanel();
      }

      function displayStatusPanel()   {
        var sPanel = document.getElementById("statusPanel");

        if ((! FRONT_PANEL_MUTE) && (! isQuietTime()))   {
          sPanel.style.visibility = "hidden";
          return;
        }

        if (screen.height > screen.width)   {
          ORIENT = "portrait";
        }
        else   {
          ORIENT = "landscape";
        }


        if (FRONT_PANEL_MUTE)   {
          sPanel.style.backgroundColor = "#ffeedd";
          sPanel.style.visibility = "visible";
          sPanel.style.fontWeight = "bolder";
          sPanel.style.border = "5px solid #ff3333";

          if (ORIENT == "portrait")   {
            sPanel.innerHTML = muteText1.fontcolor("#ff3333");
          }
          else   {
            sPanel.innerHTML = muteText2.fontcolor("#ff3333");
          }
        }
        else if (isQuietTime())   {
          sPanel.style.backgroundColor = "#ddeeff";
          sPanel.style.visibility = "visible";
          sPanel.style.fontWeight = "bolder";
          sPanel.style.border = "5px solid #3333aa";

          if (ORIENT == "portrait")   {
            sPanel.innerHTML = quietTimeText1.fontcolor("#3333aa");
          }
          else   {
            sPanel.innerHTML = quietTimeText2.fontcolor("#3333aa");
          }
        }

        if (SIZE == "small")   {
//
//   Small Portrait
//
          if (ORIENT == "portrait")   {
            sPanel.style.left = "6px";
            sPanel.style.top = "437px";
            sPanel.style.width = "218px";
            sPanel.style.height = "27px";
            sPanel.style.fontSize = "24px";
          }
//
//   Small Landscape
//
          else   {
            sPanel.style.width = "135px";
            sPanel.style.height = "56px";
            sPanel.style.fontSize = "24px";

            if (localStorage["theme"] == "London")   {
              sPanel.style.left = "35px";
              sPanel.style.top = "180px";
            }
            else   {
              sPanel.style.left = "320px";
              sPanel.style.top = "130px";
            }
          }
        }
        else   {
//
//   Large Portrait
//
          if (ORIENT == "portrait")   {
            sPanel.style.left = "15px";
            sPanel.style.top = "878px";
            sPanel.style.width = "372px";
            sPanel.style.height = "52px";
            sPanel.style.fontSize = "46px";
          }
//
//   Large Landscape
//
          else   {
            if (localStorage["theme"] == "London")   {
              sPanel.style.left = "100px";
              sPanel.style.top = "460px";
              sPanel.style.width = "267px";
              sPanel.style.height = "103px";
              sPanel.style.fontSize = "46px";
            }
            else   {
              sPanel.style.left = "650px";
              sPanel.style.top = "260px";
              sPanel.style.width = "267px";
              sPanel.style.height = "103px";
              sPanel.style.fontSize = "46px";
            }
          }
        }
      }



      function setLanguage()   {

        localStorage["language"] = "";

        navigator.globalization.getPreferredLanguage( function (language)   {
          myLang = language.value.substring(0, 2);
          localStorage["language"] = myLang;
//          alert(myLang);

          if (localStorage["language"] == "pt")   {
            do24Hr = true;
            mantleClockText = "RELÓGIO MANTEL";
            grandfatherClockText = "RELÓGIO AVÔ";
            document.getElementById("bongDuringCall").innerHTML = "&nbsp;BONG DURANTE O CHAMADO DE TELEFONE";
            document.getElementById("15_45_Label").innerHTML = "&nbsp;:15 e :45 CHIMES";
            document.getElementById("Half_Label").innerHTML = "&nbsp;MEIA HORA";
            document.getElementById("Hour_Label").innerHTML = "&nbsp;CHIMES HORAIS";
            helpText = "Big Ben PLUS[2a] vai ajudar você a manter o controle de tempo..--um lembrete subtil a cada 15 minutos.\n\n";
            helpText += "Tocando no ícone de ferramenta chave, aparecerá o Menu de configurações. Escolha de 6 relógios diferentes, com ou sem pêndulo. Todas as configurações são fáceis de compreender.\n\n";
            helpText += "Embora ter o Big Ben no seu bolso seja divertido, você provavelmente desejará fazer outras coisas com seu telefone ou tablet. Você pode minimizar o Big Ben tocando no ícone quadrado Minimizar na parte inferior da tela. Big Ben continuará a bongar até sair do aplicativo.\n\n";
            helpText += "Para voltar a maximizar o Bonger, toque no ícone do Big Ben. Você pode sair do aplicativo usando o ícone \"X \" vermelho no canto inferior direito. Nós apreciamos sua escolha do Big Ben Bonger PLUS. Consulte \"bigbenbonger.com\" para obter ajuda e informações adicionais.\n\n";
            helpText += "Deus salve a rainha.\n\n\numikeapps@outlook.com";
            helpTextTitle = "Bem-vindo ao Big Ben Bonger PLUS";
            helpDismissText = "DISPENSAR";
            quitConfirmText = "Você quer sair do Big Ben Bonger?";
            backgroundNotificationText = "[Toque aqui para restaurar]";
            optionsInText = "OPÇÕES >";
            optionsOutText = "< OPÇÕES";
            quietTimeTextNotification = "[Tempo Quieto]  ";
            quietTimeText1 = "TEMPO QU.TO";
            quietTimeText2 = "TEMPO<br /> QUIETO";
            muteText1 = "SEM SON";
            muteText2 = "SEM<br />SON";
            muteTextNotification = "[Sem Som]  ";

            cuckooClockText = "RELÓGIO DE CUCO";
            electronicClockText = "RELÓGIO ELETRÔNICO";
            trinityText = "TRINITY CHIMES";

            document.getElementById("useQTLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;Usar TEMPO QUIETO:</span>";
            document.getElementById("themeLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;TEMA:</span>";
            document.getElementById("SstartLabel").innerHTML = "Último Bong";
            document.getElementById("EendLabel").innerHTML = "Primeiro Bong";
            document.getElementById("usePendulumLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;PÊNDULO:&nbsp;&nbsp;</span>";
            document.getElementById("autoStartTextDiv").innerHTML = "AUTO-START QUANDO O TELEFONE INICIA";
          }
          else if (localStorage["language"] == "fr")   {
            do24Hr = true;
            mantleClockText = "HORLOGE MANTELLE";
            grandfatherClockText = "HORLOGE GRAND-PÈRE";
            document.getElementById("bongDuringCall").innerHTML = " BONG DURANT LE TÉLÉPHONE<br /><br />";
            document.getElementById("15_45_Label").innerHTML = "&nbsp;:15 &amp; :45 CHIMES";
            document.getElementById("Half_Label").innerHTML = "&nbsp;DEMI-PASSÉ";
            document.getElementById("Hour_Label").innerHTML = "&nbsp;CHIMES HORAIRES";
            helpText = "Laissez Big Ben PLUS[2a] vous aider à garder une trace du temps -- un rappel subtil toutes les 15 minutes.\n\n";
            helpText += "Appuyez sur l'icône WRENCH pour afficher le  Réglages. Choisissez parmi 6 horloges différentes, avec ou sans pendule. Tous les paramètres sont faciles à comprendre.\n\n";
            helpText += "Bien que l'utilisation de Big Ben soit cool, vous voudrez probablement faire autre chose avec votre téléphone ou votre tablette. Vous pouvez réduire Big Ben en appuyant sur l'icône de réduction bleu carré en bas de l'écran. Big Ben continuera à bonger jusqu'à ce que vous quittiez l'application.\n\n";
            helpText += "Pour re-maximiser le Bonger, appuyez sur l'icône Big Ben. Vous pouvez ensuite quitter l'application à l'aide de l'icône \"X\" rouge située dans le coin inférieur droit. Merci d’avoir choisi Big Ben Bonger PLUS. Voir \"bigbenbonger.com\" pour obtenir de l'aide et des informations supplémentaires.\n\n";
            helpText += "Dieu sauve la reine.\n\n\numikeapps@outlook.com";
            helpTextTitle = "Bienvenue au Big Ben Bonger PLUS";
            helpDismissText ="RENVOYER";
            quitConfirmText = "Voulez-vous quitter Big Ben Bonger?";
            backgroundNotificationText = "[Tapez ici pour restaurer]";
            optionsInText = "OPTIONS >";
            optionsOutText = "< OPTIONS";
            quietTimeTextNotification = "[Moments de Silence]  ";
            quietTimeText1 = "SILENCE";
            quietTimeText2 = "MOMENTS<br />DE SILENCE";
            muteText1 = "MUET SUR";
            muteText2 = "MUET<br />SUR";
            muteTextNotification = "[Muet]  ";

            cuckooClockText = "HORLOGE COUCOU";
            electronicClockText = "HORLOGE ÉLECTRONIQUE";
            trinityText = "TRINITY CHIMES";

            document.getElementById("useQTLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;Utilisez SILENCE TEMPS</span>";
            document.getElementById("themeLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;THÈME:</span>";
            document.getElementById("SstartLabel").innerHTML = "Dernier Bong";
            document.getElementById("EendLabel").innerHTML = "Premier Bong";
            document.getElementById("usePendulumLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;PENDULE:&nbsp;&nbsp;</span>";
            document.getElementById("autoStartTextDiv").innerHTML = "DÉMARRAGE AUTOMATIQUE AU<br />DÉMARRAGE DU TÉLÉPHONE";

            document.getElementById("EendLabel").style.marginLeft = "40px";

          }
          else if (localStorage["language"] == "de")   {
            do24Hr = true;
            mantleClockText = "UHR MANTEL";
            grandfatherClockText = "UHR GROßVATER";
            document.getElementById("bongDuringCall").innerHTML = " &nbsp;BONG WÄHREND DER TELEFONATE";
            document.getElementById("15_45_Label").innerHTML = "&nbsp;:15 &amp; :45 GLOCKENSPIEL";
            document.getElementById("Half_Label").innerHTML = "&nbsp;HALBE STUNDE GLOCKENSPIEL";
            document.getElementById("Hour_Label").innerHTML = "&nbsp;STÜNDLICH GLOCKENSPIEL";
            helpText = "Lassen Sie Big Ben PLUS[2a] helfen Ihnen Zeit-- alle 15 Minuten eine subtile Erinnerung.\n\n";
            helpText += "Tippen Sie auf das WERKZEUG Symbol, Optionsmenü aufzurufen.Wählen Sie aus 6 verschiedenen Uhren mit oder ohne Pendel. Alle Einstellungen sind leicht verständlich.\n\n";
            helpText += "Obwohl ein walking mit Big Ben kühl ist, sollten Sie wahrscheinlich andere Dinge mit Ihrem Smartphone oder Tablet zu tun. Sie können Big Ben minimieren, indem Sie auf das quadratische blaue Minimierungssymbol unten im Bildschirm tippen. Big Ben wird weiter bong, bis Sie die App beenden.\n\n";
            helpText += "Um die Bonger neu zu maximieren, tippen Sie auf Big Ben Symbol. Sie können die App dann mit dem roten \"X\" Symbol in der rechten unteren Ecke beenden. Vielen Dank, dass Sie sich für Big Ben Bonger PLUS entschieden haben. Hilfe und zusätzliche Informationen finden Sie unter \"bigbenbonger.com\".\n\n";
            helpText += "Gott schütze die Königin.\n\n\numikeapps@outlook.com";
            helpTextTitle = "Willkommen bei den Big Ben Bonger PLUS";
            helpDismissText ="SCHLIEßEB";
            quitConfirmText = "Willst du Big Ben Bonger verlassen?";
            backgroundNotificationText = "[Zum Wiederherstellen hier tippen]";
            optionsInText = "OPTIONEN >";
            optionsOutText = "< OPTIONEN";
            quietTimeTextNotification = "[Ruhige Zeit]  ";
            quietTimeText1 = "RUHIGE ZEIT";
            quietTimeText2 = "RUHIGE<br />ZEIT";
            muteText1 = "STUMM";
            muteText2 = "STUMM<br />EIN";
            muteTextNotification = "[Stumm]  ";
            noPendulumAdjustText = "You cannot turn the Pendulum on or off during Quiet Time.\n\nTo make adjustments to the Pendulum, simply turn off Quiet Time and try again.";

            cuckooClockText = "KUCKUCKSUHR";
            electronicClockText = "ELEKTRONISCHE UHR";
            trinityText = "TRINITY CHIMES";

            document.getElementById("useQTLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;Verwenden Sie RUHIGE ZEIT</span>";
            document.getElementById("themeLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;THEMA:</span>";
            document.getElementById("SstartLabel").innerHTML = "Zuletzt Bong";
            document.getElementById("EendLabel").innerHTML = "Zuerst Bong";
            document.getElementById("usePendulumLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;PENDEL:&nbsp;&nbsp;</span>";
            document.getElementById("autoStartTextDiv").innerHTML = "JEDER ZEIT AUTOMATISCH STARTEN";

            document.getElementById("EendLabel").style.marginLeft = "40px";
          }
          else if (localStorage["language"] == "es")   {
            do24Hr = true;
            mantleClockText = "RELOJ ANTIGUO";
            grandfatherClockText = "RELOJ DE ABUELO";
            document.getElementById("bongDuringCall").innerHTML = " &nbsp;BONG DURANTE PHONECALLS<br /><br />";
            document.getElementById("15_45_Label").innerHTML = "&nbsp;:15 &amp; :45 CHIMES";
            document.getElementById("Half_Label").innerHTML = "&nbsp;CHIMES DE LA MEDIA HORA";
            document.getElementById("Hour_Label").innerHTML = "&nbsp;CADA HORA CHIMES";
            helpText = "Big Ben Bonger PLUS[2a] te mantiene sabiendo el tiempo -- un recordatorio sutil cada 15 minutos.\n\n";
            helpText += "Al tocar el ícono de HERRAMIENTA aparecerá el menú de configuración. Elija entre 6 relojes diferentes, con o sin péndulo. Todos los ajustes son fáciles de entender.\n\n";
            helpText += "Pero lo más probable es que usted desee hacer otras cosas con su teléfono o tableta. Usted puede minimizar Big Ben pulsando en el icono del cuadrado azul de minimizar en la parte inferior de la pantalla. Big Ben continuará haciendo bong hasta que usted salga de la aplicación.\n\n";
            helpText += "Para volver a maximizar el Bonger, pulse en el icono Big Ben. Entonces usted puede salir de la aplicación usando la \"X\" del icono rojo en la esquina inferior derecha. Gracias por elegir Big Ben Bonger PLUS. Consulte \"bigbenbonger.com\" para obtener ayuda e información adicional.\n\n";
            helpText += "Dios salve a la reina.\n\n\numikeapps@outlook.com";
            helpTextTitle = "Bienvenido al Big Ben Bonger PLUS";
            helpDismissText ="DESPEDIR";
            quitConfirmText = "¿Quieres salir de Big Ben Bonger?";
            backgroundNotificationText = "[Toque aquí para restaurar]";
            optionsInText = "OPCIONES >";
            optionsOutText = "< OPCIONES";
            quietTimeTextNotification = "[Silencio Tiempo]  ";
            quietTimeText1 = "SILENCIO TMP.";
            quietTimeText2 = "SILENCIO<br />TIEMPO";
            muteText1 = "EN SILENCIO";
            muteText2 = "EN<br />SILENCIO";
            muteTextNotification = "[En Silencio]  ";
            noPendulumAdjustText = "You cannot turn the Pendulum on or off during Quiet Time.\n\nTo make adjustments to the Pendulum, simply turn off Quiet Time and try again.";

            cuckooClockText = "RELOJ CUCÚ";
            electronicClockText = "RELOJ ELECTRONICO";
            trinityText = "TRINITY CARILLONES";

            document.getElementById("useQTLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;Utilizar SILENCIO TIEMPO</span>";
            document.getElementById("themeLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;TEMA:</span>";
            document.getElementById("SstartLabel").innerHTML = "Último Bong";
            document.getElementById("EendLabel").innerHTML = "Primero Bong";
            document.getElementById("usePendulumLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;PÉNDULO:&nbsp;&nbsp;</span>";
            document.getElementById("autoStartTextDiv").innerHTML = "ARRANQUE AUTOMÁTICO<br />CUANDO TELÉFONO COMIENZA";

            document.getElementById("EendLabel").style.marginLeft = "40px";
          }
          else if (localStorage["language"] == "it")   {
            do24Hr = true;
            mantleClockText = "MANTO OROLOGIO";
            grandfatherClockText = "NONNO OROLOGIO";
            document.getElementById("bongDuringCall").innerHTML = "&nbsp;BONG DURANTE LE CHIAMATE DI TELEFONO<br /><br />";
            document.getElementById("15_45_Label").innerHTML = "&nbsp;:15 &amp; :45 CHIMES";
            document.getElementById("Half_Label").innerHTML = "&nbsp;MEZZ'ORA CHIMES";
            document.getElementById("Hour_Label").innerHTML = "&nbsp;ORARIA GLI SCIOPERI";
            helpText = "Lasciare che Big Ben PLUS[2a] ti aiuta a tenere traccia del tempo -- un promemoria unico ogni 15 minuti.\n\n";
            helpText += "Toccando l'icona gialla di strumento, si apre il Menu delle impostazioni. Scegli tra 6 diversi orologi, con o senza pendolo. Tutte le impostazioni sono facili da capire.\n\n";
            helpText += "Sebbene essere un Big Ben a piedi sia divertimento, probabilmente vorrai fare altre cose con il tuo telefono o tablet. Se tu tocchi il riquadro blu quadrato Riduci a icona, il Big Ben si sposterà sullo sfondo.Il Big Ben lo  continua fino a quando esci dall'applicazione.\n\n";
            helpText += "Per massimizzare il Bonger, tu tocchi l'icona del Big Ben PLUS. Esci dall'app utilizzando l'icona rossa \"X\" in basso vicino a destra. Grazie per aver scelto Big Ben Bonger PLUS. Vedere \"bigbenbonger.com\" per aiuto e informazioni aggiuntive.\n\n";
            helpText += "Dio salvi la regina.\n\n\numikeapps@outlook.com";
            helpTextTitle = "Big Ben Bonger PLUS";
            helpDismissText = "CHIUDERE";
            quitConfirmText = "Vuoi uscire dal Big Ben Bonger PLUS?";

            backgroundNotificationText = "[Tocca qui per ripristinare]";

            optionsInText = "OPTIONS >";
            optionsOutText = "< OPTIONS";
            quietTimeTextNotification = "[Tempo Silenzioso]  ";
            quietTimeText1 = "SILENZIOSO";
            quietTimeText2 = "TEMPO<br />SILENZIOSO";
            muteText1 = " SILENZIOSO ";
            muteText2 = "MANUALE<br />SILENZIOSO";
            muteTextNotification = "[Silenzioso]  ";
            noPendulumAdjustText = "You cannot turn the Pendulum on or off during Quiet Time.\n\nTo make adjustments to the Pendulum, simply turn off Quiet Time and try again.";

            cuckooClockText = "OROLOGIO A CUCÙ";
            electronicClockText = "OROLOGIO ELETTRONICO";
            trinityText = "CARILLON DI TRINITY";

            document.getElementById("useQTLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;Usare TEMPO SILENZIOSO</span>";
            document.getElementById("themeLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;TEMA:</span>";
            document.getElementById("SstartLabel").innerHTML = "Ultimo Bong";
            document.getElementById("EendLabel").innerHTML = "Primo Bong";
            document.getElementById("usePendulumLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;PENDOLO:&nbsp;&nbsp;</span>";
            document.getElementById("autoStartTextDiv").innerHTML = "INIZIA AUTOMATICAMENTE QUANDO<br />IL TELEFONO INIZIA";
          }
          else   {
            mantleClockText = "MANTLE CLOCK";
            grandfatherClockText = "GRANDFATHER CLOCK";
            document.getElementById("bongDuringCall").innerHTML = "&nbsp;BONG DURING PHONECALLS";
            document.getElementById("15_45_Label").innerHTML = "&nbsp;:15 &amp; :45 CHIMES";
            document.getElementById("Half_Label").innerHTML = "&nbsp;HALF HOUR CHIMES";
            document.getElementById("Hour_Label").innerHTML = "&nbsp;ON-THE-HOUR STRIKES";
            helpText = "Let Big Ben PLUS[2a] help you keep track of time -- a subtle reminder every 15 minutes.\n\n";
            helpText += "Tapping the WRENCH icon will bring up the Settings Menu. Choose from 6 different clocks, with or without pendulum. All settings are easy to understand.\n\n";
            helpText += "Although being a walking Big Ben is cool, you'll probably want to do other things with your phone or tablet. You can minimize Big Ben by tapping the square blue Minimize Icon at the bottom of the screen. Big Ben will continue to bong until you exit the app.\n\n";
            helpText += "To re-maximize the Bonger, tap the Notification Message or the Big Ben PLUS icon. You can then exit the app using the red \"X\" Icon in the bottom right corner. Thank you for choosing Big Ben Bonger PLUS. See \"bigbenbonger.com\" for Help and additional information.\n\n";
            helpText += "God Save The Queen.\n\n\numikeapps@outlook.com";
            helpTextTitle = "Big Ben Bonger PLUS";
            helpDismissText = "DISMISS";
            quitConfirmText = "Do you want to exit Big Ben Bonger?";

//            backgroundNotificationText = "[Tap the Big Ben PLUS icon to Restore]";
            backgroundNotificationText = "[Tap here to Restore]";

            optionsInText = "OPTIONS >";
            optionsOutText = "< OPTIONS";
            quietTimeText1 = "QUIET TIME";
            quietTimeText2 = "QUIET<br />TIME";
            muteText1 = "MUTE ON";
            muteText2 = "MUTE<br />ON";
            noPendulumAdjustText = "You cannot turn the Pendulum on or off during Quiet Time.\n\nTo make adjustments to the Pendulum, simply turn off Quiet Time and try again.";
            cuckooClockText = "CUCKOO CLOCK";
            electronicClockText = "ELECTRONIC CLOCK";
            trinityText = "TRINITY CHIMES";
            muteTextNotification = "[Mute]  ";
            quietTimeTextNotification = "[Quiet Time]  ";

            document.getElementById("useQTLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;Use QUIET TIME</span>";
            document.getElementById("themeLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;THEME:</span>";
            document.getElementById("SstartLabel").innerHTML = "Last Bong";
            document.getElementById("EendLabel").innerHTML = "First Bong";
            document.getElementById("usePendulumLabel").innerHTML = "<span style=\"color: #0000aa; font-weight: bold\">&nbsp;PENDULUM:&nbsp;&nbsp;</span>";
            document.getElementById("autoStartTextDiv").innerHTML = "AUTO-START WHEN PHONE STARTS";
          }

          if (SIZE == "big")   {
            if (localStorage["language"] == "pt")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 83px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 96px;", localStorage["eend"]);
            }
            else if (localStorage["language"] == "es")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 86px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 60px;", localStorage["eend"]);
            }
            else if (localStorage["language"] == "fr")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 83px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 70px;", localStorage["eend"]);
            }
            else if (localStorage["language"] == "de")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 83px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 61px;", localStorage["eend"]);
            }
            else if (localStorage["language"] == "it")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 83px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 69px;", localStorage["eend"]);
            }
            else {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 61px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 44px;", localStorage["eend"]);
            }
          }
          else   {   // SIZE == small
            if (localStorage["language"] == "pt")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 40px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 66px;", localStorage["eend"]);
            }
            else if (localStorage["language"] == "fr")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 44px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 45px;", localStorage["eend"]);
            }
            else if (localStorage["language"] == "de")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 44px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 42px;", localStorage["eend"]);
            }
            else if (localStorage["language"] == "es")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 40px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 41px;", localStorage["eend"]);
            }
            else if (localStorage["language"] == "it")   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 43px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 59px;", localStorage["eend"]);
            }

            else   {
              document.getElementById("startSelectDiv").innerHTML = makeTimeSelect("sstart", "margin-left: 32px; margin-top: 4px;", localStorage["sstart"]);
              document.getElementById("endSelectDiv").innerHTML = makeTimeSelect("eend", "margin-left: 40px;", localStorage["eend"]);
            }
          }



//
//  Add Select options
//
          var x = document.getElementById("clocker");

          var b = document.createElement("option");
          b.text = "BIG BEN";
          b.value = "bb";

          if ((localStorage["ding_selection"] != "bg") && (localStorage["ding_selection"] != "gf") && (localStorage["ding_selection"] != "cc") && (localStorage["ding_selection"] != "tr") && (localStorage["ding_selection"] != "ec"))  {
            b.selected = true;
          }

          x.options.add(b, 0);

          var c = document.createElement("option");
          c.text = mantleClockText;
          c.value = "bg";

          if (localStorage["ding_selection"] == "bg")   {
            c.selected = true;
          }

          x.options.add(c, 1);

          var d = document.createElement("option");
          d.text = grandfatherClockText;
          d.value = "gf";

          if (localStorage["ding_selection"] == "gf")   {
            d.selected = true;
          }

          x.options.add(d, 2);

          var e = document.createElement("option");
          e.text = electronicClockText;
          e.value = "ec";

          if (localStorage["ding_selection"] == "ec")   {
            e.selected = true;
          }

          x.options.add(e, 3);

          var f = document.createElement("option");
          f.text = trinityText;
          f.value = "tr";

          if (localStorage["ding_selection"] == "tr")   {
            f.selected = true;
          }

          x.options.add(f, 4);

          var e = document.createElement("option");
          e.text = cuckooClockText;
          e.value = "cc";

          if (localStorage["ding_selection"] == "cc")   {
            e.selected = true;
          }

          x.options.add(e, 5);

          initializeCanvas();
          init();
        },
        ignoreError2() );

      }

      function changeNotification(what)   {
        if (what == "Mute On")   {
          notificationPrefixText = muteTextNotification;
        }
        else if (what == "Quiet Time")   {
          notificationPrefixText = quietTimeTextNotification;
        }
        else   {
          notificationPrefixText = "";
        }

        firstTimeInBG = true;
        cordova.plugins.backgroundMode.configure({ text: notificationPrefixText + backgroundNotificationText, resume: true  });

      }


      function changeClock()   {
        var xx = document.getElementById("clocker");
        var theValue = xx.options[xx.selectedIndex].value;
        localStorage["ding_selection"] = theValue;

//        alert("The value of your clock is " + theValue);

        selectClock(theValue);

        QUARTER_DING = localStorage["ding_selection"] + "_quarter.mp3";
        HALF_DING  = localStorage["ding_selection"] + "_half.mp3";
        THREE_QUARTER_DING = localStorage["ding_selection"] + "_three-quarter.mp3";
        HOUR_DING = localStorage["ding_selection"] + "_hour.mp3";
        DING_SELECTION = localStorage["ding_selection"];
      }

      function selectClock(dinger)   {
        var timeoutDelay;

        DING_SELECTION     = dinger;
        localStorage["ding_selection"] = dinger;
        var dingerFile = this.root + "audio/" + dinger + "_quarter.mp3";

        if(my_media_WHICH != "NOT_RUNNING")   {
          clearTimeout(Timeouter);
          my_media_WHICH.stop();
          my_media_WHICH.release();
          my_media_WHICH = "NOT_RUNNING";
        }

        if(my_media_TEST != "NOT_RUNNING")   {
          clearTimeout(delayRelease);
          my_media_TEST.stop();
          my_media_TEST.release();
          my_media_TEST = "NOT_RUNNING";
        }

        my_media_WHICH = new Media(dingerFile,
           function () { console.log("playAudio():Audio Success"); },
           ignoreError()
        );

        my_media_WHICH.play();
        my_media_WHICH.setVolume(MASTER_VOLUME);

        switch (dinger)   {
          case "bb":  timeoutDelay = 15000;
                      break;
          case "cc":  timeoutDelay = 2500;
                      break;
          default:    timeoutDelay = 20000;
        }

        Timeouter = setTimeout(function()   {
            my_media_WHICH.stop();
            my_media_WHICH.release();
            my_media_WHICH = "NOT_RUNNING";
          }, timeoutDelay);
      }

      function loadGlobals()   {
        var ratio = window.devicePixelRatio || 1;

// Displayable Objects

        document.getElementById("t2id").style.display = "inline";
        document.getElementById("useQT").style.marginTop = "0";

// Device Size and Orientation
        if (screen.height > screen.width)   {
          ORIENT = "portrait";
        }
        else   {
          ORIENT = "landscape";
          document.getElementById("t2id").style.display = "none";
          document.getElementById("useQT").style.marginTop = "15px";

        }

        if (SIZE == "big")   {
          body.style.fontSize = "22px";

          if (ORIENT == "portrait")   {
            D_setupButtonDiv.style.top = "0px";
            D_setupButtonDiv.style.right = "2px";
            document.getElementById("panel2").style.top = "395px";
            document.getElementById("panel2").style.left = "10px";
          }
          else   {

            document.getElementById("panel2").style.top = "25px";
            document.getElementById("panel2").style.left = "410px";

          }
        }
        else   {
          body.style.fontSize = "12px";

          if (ORIENT == "portrait")   {
            D_setupButtonDiv.style.top = "230px";
            D_setupButtonDiv.style.right = "0";
            document.getElementById("panel1").style.top = "10px";
            document.getElementById("panel2").style.left =  "10px";
            document.getElementById("panel2").style.top = "255px";
          }
          else   {
            document.getElementById("panel2").style.left = "270px";
            document.getElementById("panel2").style.top = "25px";
            document.getElementById("panel1").style.top = "0";
            D_setupButtonDiv.style.top = "220px";
            D_setupButtonDiv.style.right = "0";
          }

        }

      }


      function doLondonTheme()   {
        localStorage["theme"] = "London";

        D_MyCanvas.style.display = "none";

        D_clock.style.display = "block";

//        D_setupButtonDiv.style.marginTop = "-70px";

        body.style.backgroundSize = "cover";

        if (ORIENT == "portrait")   {
          body.style.backgroundImage = 'url("img/bgLondonP.png")';

          if (SIZE == "small")   {
//            D_setupButtonDiv.style.marginTop = "-70px";
            D_clock.style.top = "340px";
            D_clock.style.marginLeft = "0px";
            D_clock.style.fontSize = "75px";
          }
          else   {
            document.getElementById("setup_butt").style.marginTop = "525px";
            D_setupButtonDiv.style.marginTop = "-70px";
            D_clock.style.top = "251px";
            D_clock.style.marginLeft = "0px";
            D_clock.style.fontSize = "150px";
          }
        }
        else   {
          body.style.backgroundImage = 'url("img/bgLondonL.png")';

          if (SIZE == "small")   {
            D_setupButtonDiv.style.marginTop = "-15px";
            D_clock.style.top = "115px";
            D_clock.style.marginLeft = "-47px";
            D_clock.style.fontSize = "120px";
          }
          else   {
            document.getElementById("setup_butt").style.marginTop = "425px";
            D_setupButtonDiv.style.marginTop = "-15px";
            D_clock.style.top = "175px";
            D_clock.style.fontSize = "240px";
            D_clock.style.marginRight = "47px";
          }

        }

      }

      function doBigBenTheme()   {
        localStorage["theme"] = "BigBen";

        D_clock.style.display = "none";
        body.style.backgroundSize = "auto";

        if (ORIENT == "portrait")   {
          if (SIZE == "small")   {
            body.style.backgroundImage = 'url("img/bgBenSP.jpg")';
            D_setupButtonDiv.style.marginTop = "0px";
          }
          else   {
            body.style.backgroundImage = 'url("img/bgBenBP.jpg")';
            D_setupButtonDiv.style.marginTop = "0px";
          }
        }
        else   {
          if (SIZE == "small")   {
            body.style.backgroundImage = 'url("img/bgBenSL.jpg")';
            D_setupButtonDiv.style.marginTop = "0px";
          }
          else   {
            body.style.backgroundImage = 'url("img/bgBenBL.jpg")';
            D_setupButtonDiv.style.marginTop = "0px";
            D_setupButtonDiv.style.marginRight = "10px";
          }
        }

        D_MyCanvas.style.display = "block";

      }

      function doAutoStart()   {
        if (document.getElementById("autostart").checked == true)   {
          cordova.plugins.autoStart.enable();
          localStorage["autostart"] = "checked";
        }
        else   {
          cordova.plugins.autoStart.disable();
          localStorage["autostart"] = "no";
        }
      }

      function doPhoneMute()   {
        if (document.getElementById("no_phone_mute").checked == true)   {
          localStorage["no_phone_mute"] = "checked";
        }
        else   {
          localStorage["no_phone_mute"] = "no";
        }
      }

      function doScreenSpecs()  {
        var ratio = window.devicePixelRatio || 1;
        var oput = "SIZE: " + SIZE + "\rORIENTATION: " + ORIENT + "\rSCREEN WIDTH: " + screen.width;
        oput += "\rSCREEN HEIGHT: " + screen.height + "\rPIXEL RATIO: " + ratio;
        alert (oput);
      }


      function ignoreError(err){
        ;
      }

      function ignoreError2(){
        ;
      }

///////////////////////////////////////
///////////////////////////////////////

//  Should be called only once in starter(). Size of the device will not change.
//
      function getScreenSize()   {
        var ratio = window.devicePixelRatio || 1;
        if ((screen.height / ratio > 780) || (screen.width / ratio > 780))   {
          SIZE = "big";
        }
        else   {
          SIZE = "small";
        }
//        alert("SIZE is " + SIZE);
      }

//  Called every time orientation changes
//
      function onOChange()   {
        ORIENT = (screen.height > screen.width) ? "portrait" : "landscape";
        DEVICE_TYPE = SIZE + "-" + ORIENT;
//        alert("DEVICE_TYPE is " + DEVICE_TYPE);

        if (localStorage["theme"] == "BigBen")   {
          doBigBenTheme();
        }
        else   {
          doLondonTheme();
        }
      }


    </script>

  </body>

</html>
